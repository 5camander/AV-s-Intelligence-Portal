<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css" />
    <link rel="stylesheet" href="css/qgis2web.css" />
    <link rel="stylesheet" href="css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="css/MarkerCluster.css" />
    <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="css/leaflet.photon.css" />
    <style>
      html,
      body,
      #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
      /* Title banner */
      .titlebar {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: #0d47a1; /* biru */
        color: #fff; /* font putih */
        padding: 10px 16px;
        border-radius: 12px;
        font-weight: 700;
        letter-spacing: 0.3px;
        z-index: 1000;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        white-space: nowrap;
      }

      /* Sembunyikan tanda panah pada layer control */
      .leaflet-control-layers-toggle {
        display: none !important;
      }

      /* Responsive: Title bar for mobile */
      @media (max-width: 768px) {
        .titlebar {
          font-size: 16px;
          padding: 7px 10px;
        }
      }
      /* Info box */
      .infobox {
        position: absolute;
        left: 10px;
        bottom: 10px;
        max-width: 380px;
        max-height: 42vh;
        overflow: auto;
        background: #ffffff; /* background putih */
        color: #000000; /* font hitam */
        padding: 12px 14px;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.18);
        z-index: 1000;
        line-height: 1.35;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
      }
      /* Responsive: Info box for mobile */
      @media (max-width: 600px) {
        .infobox {
          max-width: 90vw;
          max-height: 32vh;
          font-size: 12px;
          padding: 8px 10px;
        }
        .infobox h3 {
          font-size: 14px;
        }
        .infobox p {
          font-size: 12px;
        }
      }
      .infobox h3 {
        margin: 0 0 6px 0;
        font-size: 16px;
      }
      .infobox p {
        margin: 0;
        font-size: 13px;
      }

      /* Styling untuk Layer Control */
      .leaflet-control-layers {
        background: rgba(255, 255, 255, 0.95) !important;
        border: 1px solid rgba(0, 0, 0, 0.1) !important;
        border-radius: 10px !important;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.12) !important;
        backdrop-filter: blur(8px) !important;
        padding: 0px !important;
        min-width: 180px !important;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif !important;
      }

      .leaflet-control-layers-list {
        color: #333 !important;
      }

      /* Header untuk sections */
      .leaflet-control-layers-base::before {
        content: "PETA DASAR";
        display: block;
        font-size: 10px;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
        padding-bottom: 3px;
        border-bottom: 1px solid #eee;
      }

      .leaflet-control-layers-overlays::before {
        content: "LAPISAN";
        display: block;
        font-size: 10px;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
        padding-bottom: 3px;
        border-bottom: 1px solid #eee;
      }

      .leaflet-control-layers-base label,
      .leaflet-control-layers-overlays label {
        display: flex !important;
        align-items: center !important;
        padding: 6px 4px !important;
        margin: 1px 0 !important;
        border-radius: 6px !important;
        transition: all 0.2s ease !important;
        cursor: pointer !important;
        color: #333 !important;
        font-weight: 400 !important;
        font-size: 13px !important;
        background: transparent !important;
      }

      .leaflet-control-layers-base label:hover,
      .leaflet-control-layers-overlays label:hover {
        background: rgba(0, 0, 0, 0.05) !important;
        transform: translateX(2px) !important;
      }

      /* Radio buttons dan checkboxes */
      .leaflet-control-layers input[type="radio"],
      .leaflet-control-layers input[type="checkbox"] {
        width: 14px !important;
        height: 14px !important;
        margin-right: 8px !important;
        accent-color: #007aff !important;
      }

      /* Separator antara basemaps dan overlays */
      .leaflet-control-layers-separator {
        border-top: none !important;
        margin: 8px 0 !important;
      }

      /* Styling untuk zoom control */
      .leaflet-control-zoom {
        border: 1px solid rgba(0, 0, 0, 0.1) !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
        background: rgba(255, 255, 255, 0.95) !important;
      }

      .leaflet-control-zoom-in,
      .leaflet-control-zoom-out {
        background: rgba(255, 255, 255, 0.95) !important;
        color: #333 !important;
        border: none !important;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
        width: 36px !important;
        height: 36px !important;
        font-size: 16px !important;
        font-weight: 500 !important;
        transition: all 0.2s ease !important;
      }

      .leaflet-control-zoom-out {
        border-bottom: none !important;
      }

      .leaflet-control-zoom-in:hover,
      .leaflet-control-zoom-out:hover {
        background: rgba(0, 0, 0, 0.05) !important;
        color: #007aff !important;
      }

      /* Responsive untuk mobile */
      @media (max-width: 768px) {
        .leaflet-control-layers {
          min-width: 120px !important;
          padding: 6px !important;
          font-size: 10px !important;
          margin-left: 10px !important;
          max-width: 140px !important;
          top: 60px !important;
        }

        .leaflet-control-layers-base::before,
        .leaflet-control-layers-overlays::before {
          font-size: 8px !important;
          margin-bottom: 3px !important;
          padding-bottom: 1px !important;
        }

        .leaflet-control-layers-base label,
        .leaflet-control-layers-overlays label {
          padding: 3px 1px !important;
          font-size: 10px !important;
        }

        .leaflet-control-layers input[type="radio"],
        .leaflet-control-layers input[type="checkbox"] {
          width: 10px !important;
          height: 10px !important;
          margin-right: 4px !important;
        }

        .leaflet-control-layers-separator {
          margin: 4px 0 !important;
        }  
      }

      /* Responsive: Move zoom control below titlebar on mobile */
      @media (max-width: 768px) {
        .leaflet-control-zoom {
          top: 60px !important; /* geser ke bawah titlebar */
          right: auto !important;
          z-index: 1001;
        }
      }
    </style>
    <title>PETA RAWAN BANJIR SUMATERA SELATAN üåä</title>
  </head>
  <body>
    <!-- Title -->
    <div class="titlebar">ANALISIS TITIK SUMUR SUMATERA SELATAN üåä</div>

    <!-- Info Box -->
    <div class="infobox">
      <h3>‚ÑπÔ∏è Informasi</h3>
      <p>
        Peta ini berisikan informasi mengenai titik sumur milik PT Pertamina
        Hulu Rokan Regional 1 di Sumatera Selatan. Pada setiap titik sumur
        memuat informasi nama sumur, status sumur, jenis tanah, kerawanan
        banjir, curah hujan, latitude, longitude, serta kabupaten. Segala
        informasi didapatkan melalui analisis spasial yang telah dilakukan oleh
        pembuat peta.
      </p>
    </div>

    <div id="map"></div>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet.photon.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="data/sungai_1.js"></script>
    <script src="data/PlanWell_OG_2.js"></script>
    <script src="data/BATAS_SUMSEL_3.js"></script>
    <script>
      var map = L.map("map", {
        zoomControl: false,
        maxZoom: 28,
        minZoom: 1,
      }).fitBounds([
        [-4.7410594097991865, 101.00653957538078],
        [-1.3695450757283538, 107.63628536189766],
      ]);
      var hash = new L.Hash(map);
      map.attributionControl.setPrefix(
        '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>'
      );
      var autolinker = new Autolinker({
        truncate: { length: 30, location: "smart" },
      });
      // remove popup's row if "visible-with-data"
      function removeEmptyRowsFromPopupContent(content, feature) {
        var tempDiv = document.createElement("div");
        tempDiv.innerHTML = content;
        var rows = tempDiv.querySelectorAll("tr");
        for (var i = 0; i < rows.length; i++) {
          var td = rows[i].querySelector("td.visible-with-data");
          var key = td ? td.id : "";
          if (
            td &&
            td.classList.contains("visible-with-data") &&
            feature.properties[key] == null
          ) {
            rows[i].parentNode.removeChild(rows[i]);
          }
        }
        return tempDiv.innerHTML;
      }
      // add class to format popup if it contains media
      function addClassToPopupIfMedia(content, popup) {
        var tempDiv = document.createElement("div");
        tempDiv.innerHTML = content;
        if (tempDiv.querySelector("td img")) {
          popup._contentNode.classList.add("media");
          // Delay to force the redraw
          setTimeout(function () {
            popup.update();
          }, 10);
        } else {
          popup._contentNode.classList.remove("media");
        }
      }
      // Controls
      var bounds_group = new L.featureGroup([]);
      function setBounds() {}

      // ---- Basemaps ----
      // ---- Basemaps ----
      var osmStandard = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          attribution: "¬© OpenStreetMap contributors",
        }
      );

      var osmSat = L.tileLayer(
        "https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",
        {
          maxZoom: 20,
          subdomains: ["mt0", "mt1", "mt2", "mt3"],
        }
      );

      var osmTopo = L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
        {
          attribution: "Tiles ¬© Esri",
        }
      );

      var osmDark = L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
        {
          attribution: "¬© OpenStreetMap contributors & CARTO",
          subdomains: "abcd",
          maxZoom: 19,
        }
      );

      // aktifkan salah satu default
      osmStandard.addTo(map);

      function pop_sungai_1(feature, layer) {
        var popupContent =
          '<table>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["osm_id"] !== null
            ? autolinker.link(
                String(feature.properties["osm_id"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["code"] !== null
            ? autolinker.link(
                String(feature.properties["code"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["fclass"] !== null
            ? autolinker.link(
                String(feature.properties["fclass"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["width"] !== null
            ? autolinker.link(
                String(feature.properties["width"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["name"] !== null
            ? autolinker.link(
                String(feature.properties["name"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Shape_Leng"] !== null
            ? autolinker.link(
                String(feature.properties["Shape_Leng"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Panjang"] !== null
            ? autolinker.link(
                String(feature.properties["Panjang"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          "</td>\
                    </tr>\
                </table>";
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on("popupopen", function (e) {
          addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
      }

      function style_sungai_1_0() {
        return {
          pane: "pane_sungai_1",
          opacity: 1,
          color: "rgba(0,127,255,1.0)",
          dashArray: "",
          lineCap: "square",
          lineJoin: "bevel",
          weight: 1.0,
          fillOpacity: 0,
          interactive: false,
        };
      }
      map.createPane("pane_sungai_1");
      map.getPane("pane_sungai_1").style.zIndex = 401;
      map.getPane("pane_sungai_1").style["mix-blend-mode"] = "normal";
      var layer_sungai_1 = new L.geoJson(json_sungai_1, {
        attribution: "",
        interactive: false,
        dataVar: "json_sungai_1",
        layerName: "layer_sungai_1",
        pane: "pane_sungai_1",
        onEachFeature: pop_sungai_1,
        style: style_sungai_1_0,
      });
      bounds_group.addLayer(layer_sungai_1);
      map.addLayer(layer_sungai_1);
      function pop_PlanWell_OG_2(feature, layer) {
        var popupContent =
          '<table>\
                    <tr>\
                        <th scope="row">Nama</th>\
                        <td>' +
          (feature.properties["Name"] !== null
            ? autolinker.link(
                String(feature.properties["Name"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Status</th>\
                        <td>' +
          (feature.properties["Status"] !== null
            ? autolinker.link(
                String(feature.properties["Status"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jenis Tanah</th>\
                        <td>' +
          (feature.properties["Jns Tanah"] !== null
            ? autolinker.link(
                String(feature.properties["Jns Tanah"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Rawan Banjir</th>\
                        <td>' +
          (feature.properties["Rwn Banjir"] !== null
            ? autolinker.link(
                String(feature.properties["Rwn Banjir"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Curah Hujan</th>\
                        <td>' +
          (feature.properties["Crh Hujan"] !== null
            ? autolinker.link(
                String(feature.properties["Crh Hujan"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Latitude</th>\
                        <td>' +
          (feature.properties["Latitude"] !== null
            ? autolinker.link(
                String(feature.properties["Latitude"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Longitude</th>\
                        <td>' +
          (feature.properties["Longitude"] !== null
            ? autolinker.link(
                String(feature.properties["Longitude"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kabupaten</th>\
                        <td>' +
          (feature.properties["Kabupaten"] !== null
            ? autolinker.link(
                String(feature.properties["Kabupaten"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          "</td>\
                    </tr>\
                </table>";
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on("popupopen", function (e) {
          addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
      }

      function style_PlanWell_OG_2_0() {
        return {
          pane: "pane_PlanWell_OG_2",
          radius: 4.0,
          opacity: 1,
          color: "rgba(35,35,35,1.0)",
          dashArray: "",
          lineCap: "butt",
          lineJoin: "miter",
          weight: 1,
          fill: true,
          fillOpacity: 1,
          fillColor: "rgba(231,113,72,1.0)",
          interactive: true,
        };
      }
      map.createPane("pane_PlanWell_OG_2");
      map.getPane("pane_PlanWell_OG_2").style.zIndex = 402;
      map.getPane("pane_PlanWell_OG_2").style["mix-blend-mode"] = "normal";
      var layer_PlanWell_OG_2 = new L.geoJson(json_PlanWell_OG_2, {
        attribution: "",
        interactive: true,
        dataVar: "json_PlanWell_OG_2",
        layerName: "layer_PlanWell_OG_2",
        pane: "pane_PlanWell_OG_2",
        onEachFeature: pop_PlanWell_OG_2,
        pointToLayer: function (feature, latlng) {
          var context = {
            feature: feature,
            variables: {},
          };
          return L.circleMarker(latlng, style_PlanWell_OG_2_0(feature));
        },
      });
      var cluster_PlanWell_OG_2 = new L.MarkerClusterGroup({
        showCoverageOnHover: false,
        spiderfyDistanceMultiplier: 2,
      });
      cluster_PlanWell_OG_2.addLayer(layer_PlanWell_OG_2);

      bounds_group.addLayer(layer_PlanWell_OG_2);
      cluster_PlanWell_OG_2.addTo(map);
      function pop_BATAS_SUMSEL_3(feature, layer) {
        var popupContent =
          '<table>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["OBJECTID_1"] !== null
            ? autolinker.link(
                String(feature.properties["OBJECTID_1"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["PROVINSI"] !== null
            ? autolinker.link(
                String(feature.properties["PROVINSI"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Shape_Leng"] !== null
            ? autolinker.link(
                String(feature.properties["Shape_Leng"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' +
          (feature.properties["Shape_Area"] !== null
            ? autolinker.link(
                String(feature.properties["Shape_Area"])
                  .replace(/'/g, "'")
                  .toLocaleString()
              )
            : "") +
          "</td>\
                    </tr>\
                </table>";
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on("popupopen", function (e) {
          addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
      }

      function style_BATAS_SUMSEL_3_0() {
        return {
          pane: "pane_BATAS_SUMSEL_3",
          opacity: 1,
          color: "rgba(35,35,35,1.0)",
          dashArray: "",
          lineCap: "butt",
          lineJoin: "miter",
          weight: 2.0,
          fill: true,
          fillOpacity: 1,
          fillColor: "rgba(229,182,54,0.0)",
          interactive: false,
        };
      }
      map.createPane("pane_BATAS_SUMSEL_3");
      map.getPane("pane_BATAS_SUMSEL_3").style.zIndex = 403;
      map.getPane("pane_BATAS_SUMSEL_3").style["mix-blend-mode"] = "normal";
      var layer_BATAS_SUMSEL_3 = new L.geoJson(json_BATAS_SUMSEL_3, {
        attribution: "",
        interactive: false,
        dataVar: "json_BATAS_SUMSEL_3",
        layerName: "layer_BATAS_SUMSEL_3",
        pane: "pane_BATAS_SUMSEL_3",
        onEachFeature: pop_BATAS_SUMSEL_3,
        style: style_BATAS_SUMSEL_3_0,
      });
      bounds_group.addLayer(layer_BATAS_SUMSEL_3);
      map.addLayer(layer_BATAS_SUMSEL_3);
      setBounds();

      // === Layer Control (Basemap + Overlays) ===
      var baseMaps = {
        "üåç OSM Standard": osmStandard,
        "üó∫Ô∏è Topografi": osmTopo,
        "üõ∞Ô∏è Satelit": osmSat,
        "üåë Dark Mode": osmDark,
      };

      var overlays = {
        "üíß Sungai": layer_sungai_1,
        "‚õΩ Titik Sumur": cluster_PlanWell_OG_2,
        "üó∫Ô∏è Batas Administrasi": layer_BATAS_SUMSEL_3,
      };

      L.control
        .layers(baseMaps, overlays, { collapsed: false, position: "topleft" })
        .addTo(map);

      var zoomControl = L.control.zoom({ position: "topleft" }).addTo(map);

      setBounds();
    </script>
  </body>
</html>
